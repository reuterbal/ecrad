! (C) Copyright 2015- ECMWF.
!
! This software is licensed under the terms of the Apache Licence Version 2.0
! which can be obtained at http://www.apache.org/licenses/LICENSE-2.0.
!
! In applying this licence, ECMWF does not waive the privileges and immunities
! granted to it by virtue of its status as an intergovernmental organisation
! nor does it submit to any jurisdiction.



MODULE RADIATION_SCHEME_LAYER_MOD

IMPLICIT NONE

CONTAINS

SUBROUTINE RADIATION_SCHEME_LAYER &
     & (YRADIATION, ZRGP_FIELDS, NGPTOT, NPROMA, NFLEVG, KAEROSOL, &
     &  PSOLAR_IRRADIANCE, NFSD, LSPPRAD, &
     ! OPTIONAL ARGUMENT for bit-identical results in tests
     &  ISEED)

USE FIELD_MODULE

! Modules from ifs or ifsaux libraries
USE RADIATION_SETUP , ONLY : TRADIATION
USE PARKIND1        , ONLY : JPIM, JPRB
USE YOMHOOK         , ONLY : LHOOK, DR_HOOK, JPHOOK
USE YOMLUN_ECRAD    , ONLY : NULERR
USE RADINTG_ZRGP_MOD, ONLY : RADINTG_ZRGP_TYPE

IMPLICIT NONE

! INPUT ARGUMENTS

TYPE(TRADIATION)       ,INTENT(IN), TARGET :: YRADIATION
TYPE(RADINTG_ZRGP_TYPE), INTENT(INOUT) :: ZRGP_FIELDS

! *** Array dimensions and ranges
INTEGER(KIND=JPIM),INTENT(IN)   :: NGPTOT   ! Number of columns
INTEGER(KIND=JPIM),INTENT(IN)   :: NPROMA   ! Number of columns
INTEGER(KIND=JPIM),INTENT(IN)   :: NFLEVG   ! Number of levels
INTEGER(KIND=JPIM),INTENT(IN)   :: KAEROSOL ! Number of aerosol types

! *** Single-level fields
REAL(KIND=JPRB),   INTENT(IN)   :: PSOLAR_IRRADIANCE ! (W m-2)

INTEGER,           INTENT(IN)   :: NFSD
LOGICAL,           INTENT(IN)   :: LSPPRAD

! Optional input argument (Added for validating against ecrad standalone!)
INTEGER,           INTENT(IN), OPTIONAL :: ISEED(:,:)

IF (YRADIATION%YRERAD%LERAD_ON_GPU) THEN
  CALL RADIATION_SCHEME_LAYER_OPENACC( &
     & YRADIATION, ZRGP_FIELDS, NGPTOT, NPROMA, NFLEVG, KAEROSOL, &
     &  PSOLAR_IRRADIANCE, NFSD, LSPPRAD, ISEED)
ELSE
  CALL RADIATION_SCHEME_LAYER_PARALLEL( &
     & YRADIATION, ZRGP_FIELDS, NGPTOT, NPROMA, NFLEVG, KAEROSOL, &
     &  PSOLAR_IRRADIANCE, NFSD, LSPPRAD, ISEED)
ENDIF

END SUBROUTINE RADIATION_SCHEME_LAYER

SUBROUTINE RADIATION_SCHEME_LAYER_PARALLEL &
     & (YRADIATION, ZRGP_FIELDS, NGPTOT, NPROMA, NFLEVG, KAEROSOL, &
     &  PSOLAR_IRRADIANCE, NFSD, LSPPRAD, &
     ! OPTIONAL ARGUMENT for bit-identical results in tests
     &  ISEED)

USE FIELD_MODULE

! Modules from ifs or ifsaux libraries
USE RADIATION_SETUP , ONLY : TRADIATION
USE PARKIND1        , ONLY : JPIM, JPRB
USE YOMHOOK         , ONLY : LHOOK, DR_HOOK, JPHOOK
USE YOMLUN_ECRAD    , ONLY : NULERR
USE RADINTG_ZRGP_MOD, ONLY : RADINTG_ZRGP_TYPE

IMPLICIT NONE

! INPUT ARGUMENTS

TYPE(TRADIATION)        ,INTENT(IN), TARGET :: YRADIATION
TYPE(RADINTG_ZRGP_TYPE), INTENT(INOUT) :: ZRGP_FIELDS

! *** Array dimensions and ranges
INTEGER(KIND=JPIM),INTENT(IN)   :: NGPTOT   ! Number of columns
INTEGER(KIND=JPIM),INTENT(IN)   :: NPROMA   ! Number of columns
INTEGER(KIND=JPIM),INTENT(IN)   :: NFLEVG   ! Number of levels
INTEGER(KIND=JPIM),INTENT(IN)   :: KAEROSOL ! Number of aerosol types

! *** Single-level fields
REAL(KIND=JPRB),   INTENT(IN)   :: PSOLAR_IRRADIANCE ! (W m-2)

INTEGER,           INTENT(IN)   :: NFSD
LOGICAL,           INTENT(IN)   :: LSPPRAD

! Optional input argument (Added for validating against ecrad standalone!)
INTEGER,           INTENT(IN), OPTIONAL :: ISEED(:,:)

INTEGER(KIND=JPIM) :: KIDIA, KFDIA, IBL, JKGLO
INTEGER(KIND=JPIM) :: NRADAER, NPROGAER

LOGICAL, PARAMETER :: LDEBUG = .false.

LOGICAL, PARAMETER :: LRAYFM = .false.
#ifdef BITIDENTITY_TESTING
LOGICAL, PARAMETER :: LTEST_BITID = .TRUE.
#else
LOGICAL, PARAMETER :: LTEST_BITID = .FALSE.
#endif

! Field object pointers
CLASS(FIELD_2RB), POINTER :: FIELD_2D => NULL()
CLASS(FIELD_3RB), POINTER :: FIELD_3D => NULL()

! Field pointers for each field in ZRGP
REAL(KIND=JPRB), POINTER :: PFIELD_igi(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_imu0(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iamu0(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iemiss(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_its(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_islm(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iccnl(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iccno(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ibas(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_itop(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_igelam(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_igemu(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iclon(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_islon(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iald(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ialp(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iti(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ipr(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iqs(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iwv(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iclc(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ilwa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iiwa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_irwa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_irra(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_idp(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifsd(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iecpo3(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ihpr(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iaprs(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ihti(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ipert(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iprogaero(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ire_liq(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ire_ice(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ioverlap(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iaero(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrsod(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrted(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrsodc(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrtedc(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iemit(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_isudu(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iuvdf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iparf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iparcf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_itincf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifdir(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifdif(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_icdir(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ilwderivative(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswdirectband(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswdiffuseband(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrso(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswfc(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrth(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ilwfc(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iaer(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ioz(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iico2(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iich4(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iin2o(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ino2(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ic11(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ic12(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ic22(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_icl4(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_igix(:,:) => NULL()

#include "radiation_scheme.intfb.h"

ASSOCIATE(YDERAD=>YRADIATION%YRERAD)
ASSOCIATE(LEPO3RA=>YDERAD%LEPO3RA, &
  & LAPPROXLWUPDATE=>YDERAD%LAPPROXLWUPDATE, LAPPROXSWUPDATE=>YDERAD%LAPPROXSWUPDATE, &
  & LDIAGFORCING=>YDERAD%LDIAGFORCING)

NPROGAER    = 1 !YAER_RAD_DESC%NPROGNOSTIC
NRADAER     = YRADIATION%RAD_CONFIG%N_AEROSOL_TYPES

IF(ldebug) THEN ! igi
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(1)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_igi)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igi'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! imu0
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(2)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_imu0)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR imu0'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iamu0
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(3)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iamu0)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iamu0'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iemiss
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(4)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iemiss)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iemiss'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! its
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(5)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_its)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR its'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! islm
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(6)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_islm)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR islm'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iccnl
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(7)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iccnl)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iccnl'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iccno
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(8)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iccno)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iccno'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ibas
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(9)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_ibas)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ibas'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! itop
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(10)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_itop)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR itop'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! igelam
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(11)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_igelam)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igelam'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! igemu
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(12)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_igemu)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igemu'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iclon
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(13)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iclon)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iclon'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! islon
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(14)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_islon)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR islon'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iald
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(15)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iald)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iald'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ialp
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(16)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ialp)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ialp'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iti
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(17)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iti)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iti'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ipr
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(18)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ipr)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ipr'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iqs
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(19)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iqs)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iqs'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iwv
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(20)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iwv)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iwv'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iclc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(21)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iclc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iclc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ilwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(22)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ilwa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iiwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(23)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iiwa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iiwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iswa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(24)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iswa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! irwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(25)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_irwa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR irwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! irra
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(26)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_irra)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR irra'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! idp
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(27)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_idp)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR idp'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(nfsd>0) THEN ! ifsd
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(28)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ifsd)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifsd'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.lrayfm.and.lepo3ra) THEN ! iecpo3
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(29)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iecpo3)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iecpo3'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ihpr
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(30)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ihpr)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ihpr'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iaprs
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(31)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iaprs)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaprs'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ihti
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(32)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ihti)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ihti'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lspprad) THEN ! ipert
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(33)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ipert)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ipert'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.lrayfm.and.nradaer>0) THEN ! iprogaero
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(34)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iprogaero)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iprogaero'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ire_liq
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(35)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ire_liq)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ire_liq'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ire_ice
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(36)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ire_ice)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ire_ice'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ioverlap
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(37)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ioverlap)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioverlap'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iaero
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(38)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iaero)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaero'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrsod
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(39)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_ifrsod)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrsod'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrted
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(40)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ifrted)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrted'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrsodc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(41)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_ifrsodc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrsodc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrtedc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(42)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_ifrtedc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrtedc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iemit
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(43)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iemit)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iemit'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! isudu
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(44)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_isudu)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR isudu'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iuvdf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(45)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iuvdf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iuvdf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iparf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(46)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iparf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iparf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iparcf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(47)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_iparcf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iparcf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! itincf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(48)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_itincf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR itincf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifdir
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(49)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_ifdir)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifdir'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifdif
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(50)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_ifdif)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifdif'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! icdir
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(51)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_icdir)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icdir'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxlwupdate) THEN ! ilwderivative
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(52)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ilwderivative)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwderivative'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxswupdate) THEN ! iswdirectband
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(53)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iswdirectband)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswdirectband'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxswupdate) THEN ! iswdiffuseband
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(54)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iswdiffuseband)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswdiffuseband'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrso
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(55)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ifrso)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrso'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iswfc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(56)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iswfc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswfc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrth
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(57)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ifrth)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrth'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ilwfc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(58)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ilwfc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwfc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iaer
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(59)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iaer)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaer'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ioz
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(60)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ioz)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioz'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iico2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(61)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iico2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iico2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iich4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(62)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iich4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iich4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iin2o
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(63)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iin2o)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iin2o'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ino2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(64)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ino2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ino2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic11
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(65)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ic11)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic11'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic12
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(66)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ic12)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic12'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic22
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(67)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ic22)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic22'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! icl4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(68)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_icl4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icl4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldebug) THEN ! igix
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(69)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_HOST_DATA_RDWR(PFIELD_igix)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igix'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iaer
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(70)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iaer)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaer'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.(ldiagforcing.or.lrayfm)) THEN ! ioz
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(71)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ioz)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioz'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iico2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(72)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iico2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iico2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iich4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(73)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iich4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iich4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iin2o
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(74)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_iin2o)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iin2o'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ino2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(75)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ino2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ino2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic11
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(76)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ic11)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic11'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic12
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(77)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ic12)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic12'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic22
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(78)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_ic22)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic22'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! icl4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(79)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_HOST_DATA_RDWR(PFIELD_icl4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icl4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF

!!$OMP PARALLEL DO SCHEDULE(DYNAMIC,1)&
!!$OMP&PRIVATE(JKGLO,KIDIA,KFDIA,IBL) FIRSTPRIVATE(ZRGP_FIELDS)
DO JKGLO=1,NGPTOT,NPROMA
    KIDIA=1
    KFDIA=MIN(NPROMA,NGPTOT-JKGLO+1)
    IBL=(JKGLO-1)/NPROMA+1

    ! Call the ECRAD radiation scheme
    CALL RADIATION_SCHEME &
        & (YRADIATION, &
        &  KIDIA, KFDIA, NPROMA, &                       ! startcol, endcol, ncol
        &  NFLEVG, KAEROSOL, &
        &  PSOLAR_IRRADIANCE &                               ! solar_irrad
        & ,PFIELD_iamu0(:, IBL) &
        & ,PFIELD_its(:, IBL) &
        & ,PFIELD_iald(:,:, IBL) &
        & ,PFIELD_ialp(:,:, IBL) &
        & ,PFIELD_iemiss(:,:, IBL) &
        & ,PFIELD_iccnl(:, IBL) &
        & ,PFIELD_iccno(:, IBL) &
        & ,PFIELD_igelam(:, IBL) &
        & ,PFIELD_igemu(:, IBL) &
        & ,PFIELD_islm(:, IBL) &
        & ,PFIELD_ipr(:,:, IBL) &
        & ,PFIELD_iti(:,:, IBL) &
        & ,PFIELD_iaprs(:,:, IBL) &
        & ,PFIELD_ihti(:,:, IBL) &
        & ,PFIELD_iwv(:,:, IBL) &
        & ,PFIELD_iico2(:,:, IBL) &
        & ,PFIELD_iich4(:,:, IBL) &
        & ,PFIELD_iin2o(:,:, IBL) &
        & ,PFIELD_ino2(:,:, IBL) &
        & ,PFIELD_ic11(:,:, IBL) &
        & ,PFIELD_ic12(:,:, IBL) &
        & ,PFIELD_ic22(:,:, IBL) &
        & ,PFIELD_icl4(:,:, IBL) &
        & ,PFIELD_ioz(:,:, IBL) &
        & ,PFIELD_iclc(:,:, IBL) &
        & ,PFIELD_ilwa(:,:, IBL) &
        & ,PFIELD_iiwa(:,:, IBL) &
        & ,PFIELD_irwa(:,:, IBL) &
        & ,PFIELD_iswa(:,:, IBL) &
        & ,PFIELD_iaer(:,:, IBL) &
        & ,PFIELD_iaero(:,:, IBL) &
        & ,PFIELD_ifrso(:,:, IBL) &
        & ,PFIELD_ifrth(:,:, IBL) &
        & ,PFIELD_iswfc(:,:, IBL) &
        & ,PFIELD_ilwfc(:,:, IBL) &
        & ,PFIELD_ifrsod(:, IBL) &
        & ,PFIELD_ifrted(:,:, IBL) &
        & ,PFIELD_ifrsodc(:, IBL) &
        & ,PFIELD_ifrtedc(:, IBL) &
        & ,PFIELD_ifdir(:, IBL) &
        & ,PFIELD_icdir(:, IBL) &
        & ,PFIELD_isudu(:, IBL) &
        & ,PFIELD_iuvdf(:, IBL) &
        & ,PFIELD_iparf(:, IBL) &
        & ,PFIELD_iparcf(:, IBL) &
        & ,PFIELD_itincf(:, IBL) &
        & ,PFIELD_iemit(:, IBL) &
        & ,PFIELD_ilwderivative(:,:, IBL) &
        & ,PFIELD_iswdiffuseband(:,:, IBL) &
        & ,PFIELD_iswdirectband(:,:, IBL) &
        & ,PFIELD_ifsd(:,:, IBL) &
        & ,LACC=.FALSE. &
#ifdef BITIDENTITY_TESTING
        ! To validate results against standalone ecrad, we overwrite effective
        ! radii, cloud overlap and seed with input values
        &, PRE_LIQ=PFIELD_IRE_LIQ(:,:,IBL), PRE_ICE=PFIELD_IRE_ICE(:,:,IBL) &
        &, PCLOUD_OVERLAP=PFIELD_IOVERLAP(:,:,IBL), ISEED=ISEED(:,IBL) &
#endif
        & )

END DO
!!$OMP END PARALLEL DO

END ASSOCIATE
END ASSOCIATE

END SUBROUTINE RADIATION_SCHEME_LAYER_PARALLEL

SUBROUTINE RADIATION_SCHEME_LAYER_OPENACC &
     & (YRADIATION, ZRGP_FIELDS, NGPTOT, NPROMA, NFLEVG, KAEROSOL, &
     &  PSOLAR_IRRADIANCE, NFSD, LSPPRAD, &
     ! OPTIONAL ARGUMENT for bit-identical results in tests
     &  ISEED)

USE FIELD_MODULE

! Modules from ifs or ifsaux libraries
USE RADIATION_SETUP , ONLY : TRADIATION
USE PARKIND1        , ONLY : JPIM, JPRB
USE YOMHOOK         , ONLY : LHOOK, DR_HOOK, JPHOOK
USE YOMLUN_ECRAD    , ONLY : NULERR
USE RADINTG_ZRGP_MOD, ONLY : RADINTG_ZRGP_TYPE

IMPLICIT NONE

! INPUT ARGUMENTS

TYPE(TRADIATION)        ,INTENT(IN), TARGET :: YRADIATION
TYPE(RADINTG_ZRGP_TYPE), INTENT(INOUT) :: ZRGP_FIELDS

! *** Array dimensions and ranges
INTEGER(KIND=JPIM),INTENT(IN)   :: NGPTOT   ! Number of columns
INTEGER(KIND=JPIM),INTENT(IN)   :: NPROMA   ! Number of columns
INTEGER(KIND=JPIM),INTENT(IN)   :: NFLEVG   ! Number of levels
INTEGER(KIND=JPIM),INTENT(IN)   :: KAEROSOL ! Number of aerosol types

! *** Single-level fields
REAL(KIND=JPRB),   INTENT(IN)   :: PSOLAR_IRRADIANCE ! (W m-2)

INTEGER,           INTENT(IN)   :: NFSD
LOGICAL,           INTENT(IN)   :: LSPPRAD

! Optional input argument (Added for validating against ecrad standalone!)
INTEGER,           INTENT(IN), OPTIONAL :: ISEED(:,:)

INTEGER(KIND=JPIM) :: KIDIA, KFDIA, IBL, JKGLO
INTEGER(KIND=JPIM) :: NRADAER, NPROGAER

integer :: jlon,jlev

LOGICAL, PARAMETER :: LDEBUG = .false.

LOGICAL, PARAMETER :: LRAYFM = .false.
#ifdef BITIDENTITY_TESTING
LOGICAL, PARAMETER :: LTEST_BITID = .TRUE.
#else
LOGICAL, PARAMETER :: LTEST_BITID = .FALSE.
#endif

! Field object pointers
CLASS(FIELD_2RB), POINTER :: FIELD_2D => NULL()
CLASS(FIELD_3RB), POINTER :: FIELD_3D => NULL()

! Field pointers for each field in ZRGP
REAL(KIND=JPRB), POINTER :: PFIELD_igi(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_imu0(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iamu0(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iemiss(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_its(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_islm(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iccnl(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iccno(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ibas(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_itop(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_igelam(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_igemu(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iclon(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_islon(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iald(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ialp(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iti(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ipr(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iqs(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iwv(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iclc(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ilwa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iiwa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_irwa(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_irra(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_idp(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifsd(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iecpo3(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ihpr(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iaprs(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ihti(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ipert(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iprogaero(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ire_liq(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ire_ice(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ioverlap(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iaero(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrsod(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrted(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrsodc(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrtedc(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iemit(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_isudu(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iuvdf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iparf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iparcf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_itincf(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifdir(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifdif(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_icdir(:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ilwderivative(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswdirectband(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswdiffuseband(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrso(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iswfc(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ifrth(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ilwfc(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iaer(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ioz(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iico2(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iich4(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_iin2o(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ino2(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ic11(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ic12(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_ic22(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_icl4(:,:,:) => NULL()
REAL(KIND=JPRB), POINTER :: PFIELD_igix(:,:) => NULL()

#include "radiation_scheme.intfb.h"

ASSOCIATE(YDERAD=>YRADIATION%YRERAD)
ASSOCIATE(LEPO3RA=>YDERAD%LEPO3RA, &
  & LAPPROXLWUPDATE=>YDERAD%LAPPROXLWUPDATE, LAPPROXSWUPDATE=>YDERAD%LAPPROXSWUPDATE, &
  & LDIAGFORCING=>YDERAD%LDIAGFORCING)

NPROGAER    = 1 !YAER_RAD_DESC%NPROGNOSTIC
NRADAER     = YRADIATION%RAD_CONFIG%N_AEROSOL_TYPES

IF(ldebug) THEN ! igi
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(1)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_igi)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igi'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! imu0
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(2)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_imu0)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR imu0'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iamu0
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(3)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iamu0)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iamu0'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iemiss
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(4)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iemiss)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iemiss'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! its
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(5)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_its)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR its'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! islm
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(6)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_islm)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR islm'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iccnl
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(7)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iccnl)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iccnl'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iccno
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(8)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iccno)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iccno'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ibas
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(9)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_ibas)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ibas'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! itop
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(10)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_itop)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR itop'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! igelam
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(11)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_igelam)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igelam'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! igemu
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(12)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_igemu)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igemu'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iclon
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(13)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iclon)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iclon'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! islon
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(14)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_islon)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR islon'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iald
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(15)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iald)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iald'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ialp
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(16)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ialp)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ialp'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iti
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(17)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iti)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iti'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ipr
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(18)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ipr)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ipr'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iqs
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(19)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iqs)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iqs'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iwv
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(20)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iwv)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iwv'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iclc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(21)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iclc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iclc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ilwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(22)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ilwa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iiwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(23)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iiwa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iiwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iswa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(24)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iswa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! irwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(25)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_irwa)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR irwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! irra
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(26)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_irra)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR irra'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! idp
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(27)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_idp)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR idp'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(nfsd>0) THEN ! ifsd
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(28)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ifsd)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifsd'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.lrayfm.and.lepo3ra) THEN ! iecpo3
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(29)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iecpo3)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iecpo3'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ihpr
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(30)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ihpr)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ihpr'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iaprs
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(31)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iaprs)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaprs'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ihti
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(32)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ihti)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ihti'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lspprad) THEN ! ipert
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(33)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ipert)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ipert'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.lrayfm.and.nradaer>0) THEN ! iprogaero
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(34)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iprogaero)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iprogaero'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ire_liq
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(35)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ire_liq)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ire_liq'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ire_ice
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(36)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ire_ice)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ire_ice'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ioverlap
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(37)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ioverlap)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioverlap'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iaero
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(38)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iaero)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaero'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrsod
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(39)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_ifrsod)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrsod'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrted
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(40)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ifrted)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrted'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrsodc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(41)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_ifrsodc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrsodc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrtedc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(42)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_ifrtedc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrtedc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iemit
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(43)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iemit)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iemit'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! isudu
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(44)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_isudu)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR isudu'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iuvdf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(45)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iuvdf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iuvdf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iparf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(46)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iparf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iparf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iparcf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(47)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_iparcf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iparcf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! itincf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(48)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_itincf)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR itincf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifdir
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(49)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_ifdir)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifdir'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifdif
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(50)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_ifdif)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifdif'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! icdir
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(51)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_icdir)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icdir'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxlwupdate) THEN ! ilwderivative
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(52)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ilwderivative)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwderivative'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxswupdate) THEN ! iswdirectband
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(53)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iswdirectband)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswdirectband'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxswupdate) THEN ! iswdiffuseband
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(54)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iswdiffuseband)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswdiffuseband'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrso
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(55)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ifrso)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrso'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iswfc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(56)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iswfc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswfc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrth
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(57)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ifrth)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrth'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ilwfc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(58)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ilwfc)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwfc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iaer
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(59)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iaer)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaer'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ioz
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(60)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ioz)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioz'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iico2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(61)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iico2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iico2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iich4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(62)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iich4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iich4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iin2o
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(63)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iin2o)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iin2o'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ino2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(64)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ino2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ino2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic11
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(65)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ic11)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic11'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic12
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(66)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ic12)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic12'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic22
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(67)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ic22)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic22'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! icl4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(68)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_icl4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icl4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldebug) THEN ! igix
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(69)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%GET_DEVICE_DATA_RDWR(PFIELD_igix)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igix'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iaer
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(70)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iaer)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaer'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.(ldiagforcing.or.lrayfm)) THEN ! ioz
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(71)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ioz)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioz'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iico2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(72)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iico2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iico2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iich4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(73)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iich4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iich4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iin2o
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(74)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_iin2o)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iin2o'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ino2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(75)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ino2)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ino2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic11
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(76)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ic11)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic11'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic12
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(77)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ic12)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic12'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic22
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(78)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_ic22)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic22'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! icl4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(79)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%GET_DEVICE_DATA_RDWR(PFIELD_icl4)
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icl4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF

#ifdef BITIDENTITY_TESTING
!$ACC DATA COPYIN(iseed) ASYNC(1)
#endif

DO JKGLO=1,NGPTOT,NPROMA
    KIDIA=1
    KFDIA=MIN(NPROMA,NGPTOT-JKGLO+1)
    IBL=(JKGLO-1)/NPROMA+1

    ! Call the ECRAD radiation scheme
    CALL RADIATION_SCHEME &
        & (YRADIATION, &
        &  KIDIA, KFDIA, NPROMA, &                       ! startcol, endcol, ncol
        &  NFLEVG, KAEROSOL, &
        &  PSOLAR_IRRADIANCE &                               ! solar_irrad
        & ,PFIELD_iamu0(:, IBL) &
        & ,PFIELD_its(:, IBL) &
        & ,PFIELD_iald(:,:, IBL) &
        & ,PFIELD_ialp(:,:, IBL) &
        & ,PFIELD_iemiss(:,:, IBL) &
        & ,PFIELD_iccnl(:, IBL) &
        & ,PFIELD_iccno(:, IBL) &
        & ,PFIELD_igelam(:, IBL) &
        & ,PFIELD_igemu(:, IBL) &
        & ,PFIELD_islm(:, IBL) &
        & ,PFIELD_ipr(:,:, IBL) &
        & ,PFIELD_iti(:,:, IBL) &
        & ,PFIELD_iaprs(:,:, IBL) &
        & ,PFIELD_ihti(:,:, IBL) &
        & ,PFIELD_iwv(:,:, IBL) &
        & ,PFIELD_iico2(:,:, IBL) &
        & ,PFIELD_iich4(:,:, IBL) &
        & ,PFIELD_iin2o(:,:, IBL) &
        & ,PFIELD_ino2(:,:, IBL) &
        & ,PFIELD_ic11(:,:, IBL) &
        & ,PFIELD_ic12(:,:, IBL) &
        & ,PFIELD_ic22(:,:, IBL) &
        & ,PFIELD_icl4(:,:, IBL) &
        & ,PFIELD_ioz(:,:, IBL) &
        & ,PFIELD_iclc(:,:, IBL) &
        & ,PFIELD_ilwa(:,:, IBL) &
        & ,PFIELD_iiwa(:,:, IBL) &
        & ,PFIELD_irwa(:,:, IBL) &
        & ,PFIELD_iswa(:,:, IBL) &
        & ,PFIELD_iaer(:,:, IBL) &
        & ,PFIELD_iaero(:,:, IBL) &
        & ,PFIELD_ifrso(:,:, IBL) &
        & ,PFIELD_ifrth(:,:, IBL) &
        & ,PFIELD_iswfc(:,:, IBL) &
        & ,PFIELD_ilwfc(:,:, IBL) &
        & ,PFIELD_ifrsod(:, IBL) &
        & ,PFIELD_ifrted(:,:, IBL) &
        & ,PFIELD_ifrsodc(:, IBL) &
        & ,PFIELD_ifrtedc(:, IBL) &
        & ,PFIELD_ifdir(:, IBL) &
        & ,PFIELD_icdir(:, IBL) &
        & ,PFIELD_isudu(:, IBL) &
        & ,PFIELD_iuvdf(:, IBL) &
        & ,PFIELD_iparf(:, IBL) &
        & ,PFIELD_iparcf(:, IBL) &
        & ,PFIELD_itincf(:, IBL) &
        & ,PFIELD_iemit(:, IBL) &
        & ,PFIELD_ilwderivative(:,:, IBL) &
        & ,PFIELD_iswdiffuseband(:,:, IBL) &
        & ,PFIELD_iswdirectband(:,:, IBL) &
        & ,PFIELD_ifsd(:,:, IBL) &
        &, LACC=.TRUE. &
#ifdef BITIDENTITY_TESTING
        ! To validate results against standalone ecrad, we overwrite effective
        ! radii, cloud overlap and seed with input values
        &, PRE_LIQ=PFIELD_IRE_LIQ(:,:,IBL), PRE_ICE=PFIELD_IRE_ICE(:,:,IBL) &
        &, PCLOUD_OVERLAP=PFIELD_IOVERLAP(:,:,IBL), ISEED=ISEED(:,IBL) &
#endif
        & )

END DO

!$ACC WAIT

#ifdef BITIDENTITY_TESTING
!$ACC END DATA
#endif

IF(ldebug) THEN ! igi
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(1)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igi'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! imu0
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(2)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR imu0'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iamu0
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(3)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iamu0'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iemiss
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(4)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iemiss'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! its
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(5)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR its'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! islm
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(6)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR islm'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iccnl
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(7)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iccnl'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iccno
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(8)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iccno'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ibas
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(9)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ibas'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! itop
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(10)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR itop'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! igelam
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(11)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igelam'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! igemu
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(12)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igemu'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iclon
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(13)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iclon'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! islon
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(14)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR islon'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iald
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(15)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iald'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ialp
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(16)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ialp'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iti
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(17)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iti'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ipr
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(18)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ipr'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iqs
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(19)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iqs'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iwv
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(20)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iwv'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iclc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(21)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iclc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ilwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(22)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iiwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(23)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iiwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iswa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(24)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! irwa
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(25)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR irwa'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! irra
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(26)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR irra'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! idp
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(27)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR idp'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(nfsd>0) THEN ! ifsd
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(28)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifsd'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.lrayfm.and.lepo3ra) THEN ! iecpo3
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(29)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iecpo3'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ihpr
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(30)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ihpr'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iaprs
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(31)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaprs'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ihti
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(32)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ihti'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lspprad) THEN ! ipert
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(33)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ipert'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.lrayfm.and.nradaer>0) THEN ! iprogaero
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(34)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iprogaero'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ire_liq
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(35)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ire_liq'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ire_ice
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(36)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ire_ice'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ltest_bitid) THEN ! ioverlap
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(37)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioverlap'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iaero
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(38)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaero'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrsod
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(39)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrsod'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrted
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(40)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrted'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrsodc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(41)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrsodc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrtedc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(42)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrtedc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iemit
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(43)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iemit'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! isudu
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(44)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR isudu'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iuvdf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(45)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iuvdf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iparf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(46)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iparf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iparcf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(47)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iparcf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! itincf
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(48)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR itincf'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifdir
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(49)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifdir'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifdif
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(50)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifdif'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! icdir
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(51)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icdir'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxlwupdate) THEN ! ilwderivative
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(52)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwderivative'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxswupdate) THEN ! iswdirectband
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(53)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswdirectband'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(lapproxswupdate) THEN ! iswdiffuseband
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(54)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswdiffuseband'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrso
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(55)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrso'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! iswfc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(56)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iswfc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ifrth
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(57)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ifrth'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.true.) THEN ! ilwfc
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(58)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ilwfc'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iaer
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(59)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaer'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ioz
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(60)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioz'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iico2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(61)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iico2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iich4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(62)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iich4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! iin2o
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(63)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iin2o'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ino2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(64)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ino2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic11
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(65)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic11'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic12
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(66)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic12'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! ic22
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(67)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic22'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldiagforcing) THEN ! icl4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(68)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icl4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(ldebug) THEN ! igix
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(69)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_2RB )
        FIELD_2D => FLD
        CALL FIELD_2D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR igix'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iaer
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(70)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iaer'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.(ldiagforcing.or.lrayfm)) THEN ! ioz
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(71)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ioz'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iico2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(72)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iico2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iich4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(73)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iich4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! iin2o
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(74)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR iin2o'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ino2
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(75)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ino2'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic11
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(76)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic11'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic12
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(77)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic12'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! ic22
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(78)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR ic22'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF
IF(.not.ldiagforcing) THEN ! icl4
  ASSOCIATE( FLD => ZRGP_FIELDS%MEMBERS(79)%PTR )
    SELECT TYPE( FLD )
      CLASS IS( FIELD_3RB )
        FIELD_3D => FLD
        CALL FIELD_3D%SYNC_HOST_RDWR()
      CLASS DEFAULT
        WRITE(NULERR, '(A)') 'UNEXPECTED CLASS FOR icl4'
        CALL ABOR1('ERROR in RADIATION_SCHEME_LAYER')
    END SELECT
  END ASSOCIATE
END IF

END ASSOCIATE
END ASSOCIATE

END SUBROUTINE RADIATION_SCHEME_LAYER_OPENACC


END MODULE RADIATION_SCHEME_LAYER_MOD
